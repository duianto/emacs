# -*- mode: org; coding: utf-8-unix; indent-tabs-mode: nil -*-
#
# Copyright(C) Youhei SASAKI All rights reserved.
# $Lastupdate: 2012/07/30 17:50:38$
# License: Expat
#
#+TITLE: Orgモードの設定
#+AUTHOR: Youhei SASAKI
#+EMAIL: uwabami@gfd-dennou.org
* 始めに
* 基本設定
  #+BEGIN_SRC emacs-lisp
    (require 'org-install)
    (require 'org)
    ;; 打ち切らない.
    (setq org-startup-truncated nil)
    ;; ファイルを開く時は項目を折り畳んだ状態にする
    (setq org-startup-folded t)
    ;; 開いた時に画像を inline で表示しない
    (setq org-startup-with-inline-images nil)
    ;; ;; link を return で追う
    (setq org-retrun-follows-link t)
    ;; フォントロックを有効に
    (add-hook 'org-mode-hook 'turn-on-font-lock)
    ;; 基本ディレクトリ
    (setq org-directory "~/Documents/Dropbox/org/")
    ;; Agenda
    (setq org-default-notes-file (concat org-directory "remember.org"))
    ;; (when (locate-library "remember-el")
    ;;   (setq remember-annotation-functions '(org-remember-annotation))
    ;;   (setq remember-handler-functions '(org-remember-handler))
    ;;   (setq org-remember-templates
    ;;         '(("Todo" ?t "** TODO %?\n   %i\n   %a\n   %t" nil "Inbox")
    ;;           ("Bug" ?b "** TODO %?   :bug:\n   %i\n   %a\n   %t" nil "Inbox")
    ;;           ("Idea" ?i "** %?\n   %i\n   %a\n   %t" nil "New Ideas")
    ;;           )))
  #+END_SRC
* org-babel
  使う言語の追加
  #+BEGIN_SRC emacs-lisp
    (org-babel-do-load-languages
     'org-babel-load-languages
     '(
       (ruby       . t)
       (sh         . t)
       (emacs-lisp . t)
       (ditaa      . t)
       (dot        . t)
       (R          . t)
       (gnuplot    . t)
       ))
  #+END_SRC
  block 評価時の問い合わせの無効化
  #+BEGIN_SRC emacs-lisp
    (setq org-confirm-babel-evaluate nil)
  #+END_SRC
* LaTeX export の設定
  主に日本語LaTeX → pTeX 用の設定とか.
** 日本語LaTeX用の設定
   DebianのLaTeXはまだUTF-8を処理できないので, EUC-JPでexportする.
   #+BEGIN_SRC emacs-lisp
     (require 'org-latex)
     (setq org-export-latex-coding-system 'euc-jp-unix)
     (setq org-export-latex-date-format "%Y年%m月%d日")
   #+END_SRC
** jsarticle classの追加
   inputenc 等は読み込まないことにしてファイル毎にスタイルを設定する.
   #+BEGIN_SRC emacs-lisp
     (add-to-list 'org-export-latex-classes
                  '("jsarticle"
                    "\\documentclass{jsarticle}
     [NO-DEFAULT-PACKAGES]
     [NO-PACKAGES]
     [EXTRA]
     "
                      ("\\section{%s}" . "\\section*{%s}")
                      ("\\subsection{%s}" . "\\subsection*{%s}")
                      ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                      ("\\paragraph{%s}" . "\\paragraph*{%s}")
                      ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
     (setq org-export-latex-default-class "jsarticle")
   #+END_SRC
** latexmk
   PDF作成にはlatexmkを使う
   #+BEGIN_SRC emacs-lisp
     (setq org-latex-to-pdf-process
           '("latexmk -pdfdvi %f"))
   #+END_SRC
* beamer export の設定
  beamer でプレゼンするための設定
  #+BEGIN_SRC emacs-lisp
    (require 'org-beamer)
    ;; デフォルトのヘッドラインレベル -> 2
    (setq org-beamer-frame-level 2)
    ;; frame のオプション
    (setq org-beamer-frame-default-options "[fragile]")
    (setq org-export-with-sub-superscripts nil)
  #+END_SRC
* HTML export の設定
  [[http://juanreyero.com/open/org-jekyll/index.html#Org-jekyll][Org-jekyll]] [fn:1]でサイト構築を行なっているので, それにまつわる設定
  #+BEGIN_SRC emacs-lisp
    ;; org-html, org-publish
    (require 'org-html)
    (require 'org-publish)
    ;; (add-to-load-path "site-lisp/org-mode/contrib/lisp")
    ;; (require 'org-static-mathjax)
    (setq org-publish-webpage
          (expand-file-name
           (concat (getenv "HOME") "/Public/")))
    (setq org-publish-webpage-img
          (expand-file-name
           (concat org-publish-webpage "images/")))
    (add-to-list 'org-publish-project-alist
                 `("src"
                   :base-directory ,org-publish-webpage
                   :recursive t
                   :exclude ".*\.el\\|^Makefile\\|.*\.gpg\\|sitemap\.org\\|^cc-env\\|^images\\|^_site\\|config\.org"
                   :base-extension "org"
                   :headline-level 4
                   :publishing-directory ,org-publish-webpage
                   :publishing-function org-publish-org-to-html
                   :body-only t
                   )
                 )
    (add-to-list 'org-publish-project-alist
                 `("img"
                   :base-directory ,org-publish-webpage-img
                   :base-extension "jpg\\|png"
                   :publishing-directory ,org-publish-webpage-img
                   :publishing-function org-publish-attachment
                   )
                 )
    (add-to-list 'org-publish-project-alist
                 '("web" :components ("src")
                   ))
    ;; cache の置き場所を ~/.emacs.d/tmp/org-timestamps/ に変える
    (setq org-publish-timestamp-directory
          (concat my:user-emacs-temporary-directory "org-timestamps/"))
    (setq org-publish-use-timestamps-flag nil)
  #+END_SRC

* Footnotes

[fn:1] Org-jekyll: [[http://juanreyero.com/open/org-jekyll/index.html#Org-jekyll]]
