# -*- mode: org; coding: utf-8-unix; indent-tabs-mode: nil -*-
#
# Copyright(C) Youhei SASAKI All rights reserved.
# $Lastupdate: 2012/09/04 22:49:08$
# License: Expat
#
#+TITLE: org-modeの設定
#+AUTHOR: Youhei SASAKI
#+EMAIL: uwabami@gfd-dennou.org
#+SETUPFILE: ./export-config.org
#+BEGIN_HTML
---
layout: emacs
title: org-modeの設定
---
#+END_HTML
* 始めに
* 基本設定
  #+BEGIN_SRC emacs-lisp
    (require 'org-install)
    (require 'org)
    ;; 打ち切らない.
    (setq org-startup-truncated nil)
    ;; ファイルを開く時は項目を折り畳んだ状態にする
    (setq org-startup-folded t)
    ;; 開いた時に画像を inline で表示しない
    (setq org-startup-with-inline-images nil)
    ;; ;; link を return で追う
    (setq org-return-follows-link t)
    ;; フォントロックを有効に
    (add-hook 'org-mode-hook 'turn-on-font-lock)
    ;; 基本ディレクトリ
    (setq org-directory "~/Documents/Dropbox/org/")
    ;; Agenda
    (setq org-default-notes-file (concat org-directory "remember.org"))
    ;; (when (locate-library "remember-el")
    ;;   (setq remember-annotation-functions '(org-remember-annotation))
    ;;   (setq remember-handler-functions '(org-remember-handler))
    ;;   (setq org-remember-templates
    ;;         '(("Todo" ?t "** TODO %?\n   %i\n   %a\n   %t" nil "Inbox")
    ;;           ("Bug" ?b "** TODO %?   :bug:\n   %i\n   %a\n   %t" nil "Inbox")
    ;;           ("Idea" ?i "** %?\n   %i\n   %a\n   %t" nil "New Ideas")
    ;;           )))
  #+END_SRC
* org-babel
  使う言語の追加
  #+BEGIN_SRC emacs-lisp
    (org-babel-do-load-languages
     'org-babel-load-languages
     '(
       (ruby       . t)
       (sh         . t)
       (emacs-lisp . t)
       (ditaa      . t)
       (dot        . t)
       (R          . t)
       (gnuplot    . t)
       ))
  #+END_SRC
  block 評価時の問い合わせの無効化
  #+BEGIN_SRC emacs-lisp
    (setq org-confirm-babel-evaluate nil)
  #+END_SRC
* LaTeX export の設定
  主に日本語LaTeX → pTeX 用の設定とか.
** 日本語LaTeX用の設定
   DebianのLaTeXはまだUTF-8を処理できないので, EUC-JPでexportする.
   #+BEGIN_SRC emacs-lisp
     (require 'org-latex)
     (setq org-export-latex-coding-system 'euc-jp-unix)
     (setq org-export-latex-date-format "%Y年%m月%d日")
   #+END_SRC
** jsarticle classの追加
   inputenc 等は読み込まないことにしてファイル毎にスタイルを設定する.
   #+BEGIN_SRC emacs-lisp
     (add-to-list 'org-export-latex-classes
                  '("jsarticle"
                    "\\documentclass{jsarticle}
     [NO-DEFAULT-PACKAGES]
     [NO-PACKAGES]
     [EXTRA]
     "
                      ("\\section{%s}" . "\\section*{%s}")
                      ("\\subsection{%s}" . "\\subsection*{%s}")
                      ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                      ("\\paragraph{%s}" . "\\paragraph*{%s}")
                      ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
     (setq org-export-latex-default-class "jsarticle")
   #+END_SRC
** latexmk
   PDF作成にはlatexmkを使う
   #+BEGIN_SRC emacs-lisp
     (setq org-latex-to-pdf-process
           '("latexmk -pdfdvi %f"))
   #+END_SRC
* beamer export の設定
  beamer でプレゼンするための設定
  #+BEGIN_SRC emacs-lisp
    (require 'org-beamer)
    ;; デフォルトのヘッドラインレベル -> 2
    (setq org-beamer-frame-level 2)
    ;; frame のオプション
    (setq org-beamer-frame-default-options "[fragile]")
    (setq org-export-with-sub-superscripts nil)
  #+END_SRC
* HTML export の設定
  [[http://jekyllrb.com/][Jekyll]] [fn:1] でサイト構築を行なっているので, それにまつわる設定
  #+BEGIN_SRC emacs-lisp
    ;; org-html, org-publish
    (require 'org-html)
    (require 'org-publish)
    (defvar my:org-publish-webpage
      (expand-file-name
       (concat (getenv "HOME") "/Public/")))
    (defvar my:org-publish-webpage-img
      (expand-file-name
       (concat my:org-publish-webpage "images/")))
    (defvar my:org-publish-gh-pages
      (expand-file-name
       (concat (getenv "HOME") "/Sources/gh-pages")))
    (defvar my:org-publish-emacs-pages
      (expand-file-name
       (concat my:org-publish-webpage "cc-env/Emacs/")))
    (setq org-publish-project-alist
          `(
            ("public"
             :base-directory ,my:org-publish-webpage
             :recursive t
             :exclude ".*\.el\\|^Makefile\\|.*\.gpg\\|sitemap\.org\\|^cc-env\\|^images\\|^_site\\|^export-config\.org"
             :base-extension "org"
             :headline-level 4
             :htmlized-source t
             :publishing-directory ,my:org-publish-webpage
             :publishing-function org-publish-org-to-html
             :body-only t
             )
            ("img"
             :base-directory ,my:org-publish-webpage-img
             :base-extension "jpg\\|png"
             :publishing-directory ,my:org-publish-webpage-img
             :publishing-function org-publish-attachment
             )
            ("gh-pages"
             :base-directory ,my:org-publish-gh-pages
             :base-extension "org"
             :recursive nil
             :htmlized-source t
             :exclude ".*\.el\\|^Makefile\\|.*\.gpg\\|sitemap\.org\\|^cc-env\\|^images\\|^_site\\|^export-config\.org"
             :headline-level 4
             :publishing-directory my:org-publish-gh-pages
             :publishing-function org-publish-org-to-html
             :body-only t
             )
            ("Emacs"
             :base-directory ,my:user-emacs-config-directory
             :base-extension "org"
             :htmlized-source t
             :recursive nil
             :exclude "^export-config\.org"
             :headline-level 4
             :publishing-directory ,my:org-publish-emacs-pages
             :publishing-function org-publish-org-to-html
             :body-only t
             :auto-sitemap t
             :sitemap-filename "sitemap.org"
             :sitemap-title ""
             )
            ("web" :components ("public" "img"))
            ("github" :components ("gh-pages"))
            ("emacs" :components ("Emacs"))
            ))
    ;; cache の置き場所を ~/.emacs.d/tmp/org-timestamps/ に変える
    (setq org-publish-timestamp-directory
          (concat my:user-emacs-temporary-directory "org-timestamps/"))
    (setq org-publish-use-timestamps-flag nil)
  #+END_SRC
* Footnotes

[fn:1] Jeykll: [[http://jekyllrb.com/]]
