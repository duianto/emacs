# -*- mode: org; coding: utf-8-unix; indent-tabs-mode: nil -*-
#
# Copyright(C) Youhei SASAKI All rights reserved.
# License: Expat
#
#+TITLE: AutoCompleteの設定
#+AUTHOR: Youhei SASAKI
#+EMAIL: uwabami@gfd-dennou.org
#+DATE: 2014-05-28 17:00:24
#+SETUPFILE: ./export-config.org

* 始めに
  [[http://cx4a.org/software/auto-complete/index.ja.html][Auto Complete Mode]] [fn:1] を参照のこと. 大変便利なのだけれども
  Org-mode や yasnippet と共存させようとすると, 結構面倒.
  ここで設定しているのはそういうお話.
* 読み込みと初期設定
  #+BEGIN_SRC emacs-lisp
    (require 'auto-complete-config nil 'noerror)
    (add-to-list 'ac-dictionary-directories
                 (concat my:user-emacs-share-directory "ac-dict"))
    (setq ac-comphist-file
          (concat my:user-emacs-temporary-directory "ac-comphist.dat"))
    (ac-config-default)
    (ac-flyspell-workaround)
  #+END_SRC
* 全てのモードで補完を有効に
  #+BEGIN_SRC emacs-lisp
    (global-auto-complete-mode t)
    ;; 追加メジャーモード
    (add-to-list 'ac-modes 'org-mode)
  #+END_SRC
* 起動/キー設定など
  `<s'補完などを使うために 4 文字以上で起動することにする
  補完メニュー表示時には C-n/C-p で選択.
  #+BEGIN_SRC emacs-lisp
    (setq ac-auto-start 4)                         ; 4 文字以上で起動
    (setq ac-auto-show-menu 0.8)                   ; 0.8秒でメニュー表示
    (setq ac-use-comphist t)                       ; 補完候補をソート
    (setq ac-candidate-limit nil)                  ; 補完候補表示を無制限に
    (setq ac-use-quick-help nil)                   ; tool tip 無し
    (setq ac-use-menu-map t)                       ; キーバインド
    (define-key ac-menu-map (kbd "C-n")         'ac-next)
    (define-key ac-menu-map (kbd "C-p")         'ac-previous)
    (define-key ac-completing-map (kbd "<tab>") 'nil)
    ;; (define-key ac-completing-map (kbd "<tab>") 'ac-complete)
    (define-key ac-completing-map (kbd "M-/")   'ac-stop)
    (define-key ac-completing-map (kbd "RET") nil) ; return での補完禁止
    (setf (symbol-function 'yas-active-keys)
          (lambda ()
            (remove-duplicates
             (mapcan #'yas--table-all-keys (yas--get-snippet-tables)))))
  #+END_SRC
* Footnotes

[fn:1] Auto Complete Mode: [[http://cx4a.org/software/auto-complete/index.ja.html]]
